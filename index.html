<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>âœ¨ 2026 ç’€ç’¨ä¹‹çº¦ - è‡´è°¢ä¼Šè² âœ¨</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <style>
        body { margin: 0; background: #000; overflow: hidden; touch-action: none; }
        canvas { display: block; }
        #overlay {
            position: absolute; bottom: 5%; width: 100%; text-align: center;
            color: rgba(255,255,255,0.4); font-family: "Microsoft YaHei", sans-serif;
            font-size: 13px; letter-spacing: 1px; pointer-events: none;
        }
    </style>
</head>
<body>
    <div id="overlay">âœ¨ è‡ªåŠ¨å·¡æ¼”ä¸­ Â· ç‚¹å‡»å±å¹•é‡Šæ”¾æƒŠå–œ âœ¨</div>
    <canvas id="c"></canvas>

    <script>
    const canvas = document.getElementById('c');
    const ctx = canvas.getContext('2d', { alpha: false });
    let cw, ch, particles = [], fireworks = [];
    
    // --- 1. è‡ªåŠ¨è½®æ’­çš„æ–‡å­—åº“ ---
    // ä½ å¯ä»¥éšæ—¶åœ¨è¿™é‡Œæ·»åŠ æ›´å¤šçš„è¯ï¼Œæ¯”å¦‚ "æ°¸è¿œå¼€å¿ƒ", "ä¸‡äº‹èƒœæ„"
    const autoTextList = ["2026", "è°¢ä¼Šè²", "æ–°å¹´å¿«ä¹", "ğŸ†ğŸ†ğŸ†"];
    let autoTextIdx = 0;

    function init() {
        cw = canvas.width = window.innerWidth;
        ch = canvas.height = window.innerHeight;
    }

    // --- 2. æ ¸å¿ƒï¼šè·å–æ–‡å­—åƒç´ ç‚¹çš„å‡½æ•° ---
    function getPixels(text) {
        const tCanvas = document.createElement('canvas');
        const tCtx = tCanvas.getContext('2d');
        tCanvas.width = cw; tCanvas.height = ch;
        tCtx.fillStyle = "white";
        // åŠ¨æ€è®¡ç®—å­—å·ï¼šå­—æ•°è¶Šå¤šå­—å·è¶Šå°ï¼Œé˜²æ­¢æ‰‹æœºå±å¹•è£…ä¸ä¸‹
        const fontSize = text.length > 3 ? cw * 0.14 : cw * 0.22;
        tCtx.font = `bold ${fontSize}px sans-serif`;
        tCtx.textAlign = "center";
        tCtx.textBaseline = "middle";
        tCtx.fillText(text, cw/2, ch/2);
        
        const data = tCtx.getImageData(0, 0, cw, ch).data;
        const pts = [];
        const gap = 6; // é‡‡æ ·é—´è·
        for (let y = 0; y < ch; y += gap) {
            for (let x = 0; x < cw; x += gap) {
                if (data[((y * cw + x) * 4) + 3] > 128) pts.push({x, y});
            }
        }
        return pts;
    }

    // --- 3. ç²’å­ç±»ï¼šåŒ…å«æ–‡å­—æ±‡èšå’Œæ™®é€šæ•£å¼€ä¸¤ç§é€»è¾‘ ---
    class Particle {
        constructor(x, y, h, target = null, type = 'normal') {
            this.x = x; this.y = y; this.h = h;
            this.target = target;
            this.alpha = 1;
            // æ–‡å­—ç²’å­åœç•™æ—¶é—´é•¿ï¼Œæ™®é€šç²’å­æ¶ˆå¤±å¿«
            this.decay = target ? 0.006 : random(0.015, 0.03);
            
            if (target) {
                // æ–‡å­—ç²’å­ï¼šå…ˆéšæœºç‚¸å¼€ï¼Œå†æ…¢æ…¢æ±‡èš
                this.vx = random(-4, 4);
                this.vy = random(-4, 4);
            } else {
                // æ‰‹åŠ¨çƒŸèŠ±ï¼šæ™®é€šæŠ›ç‰©çº¿
                const angle = Math.random() * Math.PI * 2;
                const speed = type === 'fountain' ? random(4, 12) : random(2, 8);
                this.vx = Math.cos(angle) * speed;
                this.vy = Math.sin(angle) * speed;
            }
        }
        update() {
            if (this.target) {
                // æ ¸å¿ƒæ±‡èšç®—æ³•ï¼šå¼•åŠ›å…¬å¼
                const dx = this.target.x - this.x;
                const dy = this.target.y - this.y;
                this.vx += dx * 0.004;
                this.vy += dy * 0.004;
                this.vx *= 0.92; this.vy *= 0.92;
            } else {
                this.vy += 0.1; // é‡åŠ›
                this.vx *= 0.96; this.vy *= 0.96;
            }
            this.x += this.vx; this.y += this.vy;
            this.alpha -= this.decay;
        }
        draw() {
            ctx.fillStyle = `hsla(${this.h}, 100%, 70%, ${this.alpha})`;
            ctx.fillRect(this.x, this.y, 2, 2);
        }
    }

    // --- 4. çƒŸèŠ±è§¦å‘å‡½æ•° ---
    function launchFirework(tx, ty, isAuto = false) {
        const h = random(0, 360);
        if (isAuto) {
            // ã€è‡ªåŠ¨æ¨¡å¼ã€‘æ–‡å­—çƒŸèŠ±
            const pts = getPixels(autoTextList[autoTextIdx]);
            autoTextIdx = (autoTextIdx + 1) % autoTextList.length;
            pts.forEach(p => {
                // æ‰€æœ‰çš„æ–‡å­—ç²’å­ä»ç‚¹å‡»ä½ç½®ï¼ˆæˆ–è‡ªåŠ¨ä½ç½®ï¼‰ç‚¸å¼€å¹¶é£å‘æ–‡å­—åæ ‡
                particles.push(new Particle(tx, ty, 45, p)); // æ–‡å­—ç»Ÿä¸€ç”¨æ¸©æš–çš„é‡‘è‰²
            });
        } else {
            // ã€æ‰‹åŠ¨æ¨¡å¼ã€‘éšæœºè§¦å‘ 3 ç§çƒŸèŠ±ç‰¹æ•ˆ
            const mode = Math.floor(random(0, 3));
            const count = 120;
            if (mode === 0) {
                // ç‰¹æ•ˆ1ï¼šé‡‘è‰²å–·æ³‰
                for(let i=0; i<count; i++) particles.push(new Particle(tx, ty, 45, null, 'fountain'));
            } else if (mode === 1) {
                // ç‰¹æ•ˆ2ï¼šå½©è‰²åœ†ç¯
                for(let i=0; i<count; i++) particles.push(new Particle(tx, ty, h));
            } else {
                // ç‰¹æ•ˆ3ï¼šå†·è‰²æµæ˜Ÿ
                for(let i=0; i<count; i++) particles.push(new Particle(tx, ty, random(180, 260)));
            }
        }
    }

    // --- 5. åŠ¨ç”»ä¸»å¾ªç¯ ---
    function loop() {
        ctx.globalCompositeOperation = 'source-over';
        ctx.fillStyle = 'rgba(0,0,0,0.2)'; // è°ƒæ•´é€æ˜åº¦æ§åˆ¶æ‹–å°¾é•¿çŸ­
        ctx.fillRect(0, 0, cw, ch);
        ctx.globalCompositeOperation = 'lighter'; // è®©é‡å éƒ¨åˆ†å‘å…‰
        
        particles.forEach((p, i) => {
            p.update(); p.draw();
            if (p.alpha <= 0) particles.splice(i, 1);
        });
        requestAnimationFrame(loop);
    }

    function random(min, max) { return Math.random() * (max - min) + min; }

    // --- 6. äº¤äº’ç›‘å¬ ---
    window.addEventListener('mousedown', e => launchFirework(e.clientX, e.clientY));
    window.addEventListener('touchstart', e => {
        e.preventDefault();
        launchFirework(e.touches[0].clientX, e.touches[0].clientY);
    }, { passive: false });
    window.addEventListener('resize', init);

    init();
    loop();

    // --- 7. å®šæ—¶å™¨ï¼šæ¯ 5 ç§’è‡ªåŠ¨å¾ªç¯ä¸€æ¬¡æ–‡å­— ---
    setInterval(() => {
        launchFirework(cw/2, ch/2, true);
    }, 5000);

    // å¼€åœº 1 ç§’åè‡ªåŠ¨é‡Šæ”¾ç¬¬ä¸€ä¸ªè¯
    setTimeout(() => launchFirework(cw/2, ch/2, true), 1000);
    </script>
</body>
</html>
